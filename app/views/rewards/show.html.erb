<div class="home-bg">
  <!-- placeholder for video? -->
</div>

<!-- Spacer - need to delete -->
<div class="row">
  <div class="small-12 columns">
    <p><br><br><br></p>
  </div>
</div>

<!-- Page header -->
<div class="row">
  <div class="small-12 text-center columns">
    <h2>Last step!</h2>
  </div>
</div>

<div class="row">
  <div class="small-10 medium-6 large-6 small-centered columns">
    <p>This reward requires shipping information for the project owner.  We will only share this information once the project when the project is complete and only with the project owner.</p>
    <%= form_tag project_reward_charges_path(@project, @reward), id: 'payment-form' %>
    <div class="row collapse">
      <span class="payment-errors"></span>
      <div class="small-2 columns">
        <span class="prefix"><i class="fi-torso"></i></span>
      </div>
      <div class="small-10 columns">
        <%= text_field_tag :address, nil, placeholder: 'Your street address' %>
      </div>
    </div>

    <div class="row collapse">
      <div class="small-2 columns">
        <span class="prefix"><i class="fi-torso"></i></span>
      </div>
      <div class="small-10 columns">
        <%= text_field_tag :postal_code, nil, placeholder: 'Your postal code' %>
      </div>
    </div>

    <div class="row collapse">
      <div class="small-2 columns">
        <span class="prefix"><i class="fi-torso"></i></span>
      </div>
      <div class="small-10 columns">
        <%= text_field_tag :city, nil, placeholder: 'Your city' %>
      </div>
    </div>

    <div class="row collapse">
      <div class="small-2 columns">
        <span class="prefix"><i class="fi-torso"></i></span>
      </div>
      <div class="small-10 columns">
        <%= select_tag :province, options_for_select(['Alberta', 'British Columbia', 'Manitoba', 'New Brunswick', 'Newfoundland and Labrador', 'Nova Scotia', 'Ontario', 'Prince Edward Island', 'Quebec', 'Saskatchewan', 'Northwest Territories', 'Nunavut', 'Yukon']), prompt: 'Select your province' %>
      </div>
    </div>

    <div class="row collapse">
      <div class="small-12 columns text-center">
        <%= submit_tag "Submit", class: 'button'  %>
      </div>
    </div>

  </div>
</div>

<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script>
	Stripe.setPublishableKey('pk_test_4SPUMHwKi43qwO7iC1VZLKSi')

	jQuery(function($) {
	  $('#payment-form').submit(function(event) {
	    var $form = $(this);

	    // Disable the submit button to prevent repeated clicks
	    $form.find('button').prop('disabled', true);

	    Stripe.card.createToken($form, stripeResponseHandler);

	    // Prevent the form from submitting with the default action
	    return false;
	  });
	});

	function stripeResponseHandler(status, response) {
  var $form = $('#payment-form');

  if (response.error) {
    // Show the errors on the form
    $form.find('.payment-errors').text(response.error.message);
    $form.find('button').prop('disabled', false);
  } else {
    // response contains id and card, which contains additional card details
    var token = response.id;
    // Insert the token into the form so it gets submitted to the server
    $form.append($('<input type="hidden" name="stripeToken" />').val(token));
    // and submit
    $form.get(0).submit();
  }
};
</script>



